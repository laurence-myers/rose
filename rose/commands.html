<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Commands :: rose</title>
    <link rel="canonical" href="https://laurence-myers.github.io/rose/rose/commands.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://laurence-myers.github.io/rose">rose</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="/rose/api/">API Docs</a>
        <a class="navbar-item" href="https://github.com/laurence-myers/rose/">Code @ GitHub</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rose" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">rose</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="quick-start.html">Quick Start</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="how-it-works.html">How It Works</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="schema-introspection.html">Schema Introspection</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="constructing-and-executing-a-query.html">Constructing and Executing a Query</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="query-selectors.html">Query Selectors</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="commands.html">Commands</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="postgresql-functions.html">PostgreSQL Functions</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="connection-manager.html">Connection Manager and Database Context</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="justification.html">Why Rose?</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="alternate-projects.html">Alternate Projects</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">rose</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">rose</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">rose</a></li>
    <li><a href="commands.html">Commands</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Commands</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Commands are the outermost part of a single query. You can
<a href="https://www.postgresql.org/docs/current/sql-commands.html">refer to the list of the SQL commands supported by PostgreSQL</a>.</p>
</div>
<div class="paragraph">
<p>You can normally distinguish "command" functions from other kinds of DSL functions, because they often allow chaining
methods, and provide a <code>finalise()</code> method, which converts <a href="how-it-works.html" class="page">the intermediate AST</a> into a string.</p>
</div>
<div class="paragraph">
<p><em>rose</em> does not currently provide any Data Definition Language (DDL) commands. For many applications, you will want to
write your DDL queries directly in SQL, as they are often executed in database migrations, separate from your
application&#8217;s main code.</p>
</div>
<div class="paragraph">
<p>The API docs can help you explore the available commands and DSL functions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_select"><a class="anchor" href="#_select"></a><code>select()</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <code>SELECT</code> query. Pass it a "<a href="query-selectors.html" class="page">query selector</a>" object.</p>
</div>
<div class="sect2">
<h3 id="_chained_methods"><a class="anchor" href="#_chained_methods"></a>Chained methods</h3>
<div class="ulist">
<ul>
<li>
<p><code>distinct()</code>: <a href="https://www.postgresql.org/docs/current/sql-select.html#SQL-DISTINCT">sets the "distinct" clause</a>.</p>
</li>
<li>
<p><code>distinctOn()</code>: <a href="https://www.postgresql.org/docs/current/sql-select.html#SQL-DISTINCT">sets the "distinct on" clause</a>.</p>
</li>
<li>
<p><code>from()</code>: explicitly <a href="https://www.postgresql.org/docs/current/sql-select.html#SQL-FROM">sets the "from" clause</a>.
Note that for some queries, it&#8217;s optional to specify this:  <em>rose</em> can infer the selected tables from the column
metamodels.</p>
</li>
<li>
<p><code>groupBy()</code>: <a href="https://www.postgresql.org/docs/current/sql-select.html#SQL-GROUPBY">sets the "group by" clause</a>.</p>
</li>
<li>
<p><code>limit()</code>: <a href="https://www.postgresql.org/docs/current/sql-select.html#SQL-LIMIT">sets the "limit" clause</a>.</p>
</li>
<li>
<p><code>orderBy()</code>: <a href="https://www.postgresql.org/docs/current/sql-select.html#SQL-ORDERBY">sets the "order by" clause</a>. You can
pass column metamodels by column their <code>asc()</code> or <code>desc()</code> methods, e.g. <code>select({&#8230;&#8203;}).orderBy(QFilm.title.asc())</code>.</p>
</li>
<li>
<p><code>where()</code>: <a href="https://www.postgresql.org/docs/current/sql-select.html#SQL-WHERE">sets the "where" clause</a>.</p>
</li>
<li>
<p><code>with()</code>: used for <a href="https://www.postgresql.org/docs/current/sql-select.html#SQL-WITH">common table expression queries</a>.
Sub-queries can be created using the <code>select()</code> DSL function, wrapped in <code>withCte()</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_from_and_join_dsl"><a class="anchor" href="#_from_and_join_dsl"></a>From and Join DSL</h3>
<div class="paragraph">
<p>When calling <code>from()</code>, you can join "from" items in a few ways.</p>
</div>
<div class="paragraph">
<p>The most straightforward way is to call one of the join methods from the table metamodel. E.g.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescript hljs" data-lang="typescript">select(/* ... */).from(
  QFilm.$table
    .innerJoin(QFilmActor)
    .on(QFilmActor.filmId.eq(QFilm.filmId))
    .innerJoin(QActor)
    .on(QActor.actorId.eq(QFilmActor.actorId))
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are also DSL functions to help you construct "from" and "join" items.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>from()</code> - converts and wraps elements (AST nodes, builder instances, or even just a string for the table name) for use as a "from" item.</p>
</li>
<li>
<p><code>join()</code> - a starting point for any other type of join. E.g. <code>join(QFilm).innerJoin(&#8230;&#8203;)</code></p>
</li>
<li>
<p><code>crossJoin()</code></p>
</li>
<li>
<p><code>fullJoin()</code></p>
</li>
<li>
<p><code>innerJoin()</code></p>
</li>
<li>
<p><code>leftJoin()</code></p>
</li>
<li>
<p><code>rightJoin()</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_with_queries_common_table_expressions"><a class="anchor" href="#_with_queries_common_table_expressions"></a>With queries / common table expressions</h3>
<div class="paragraph">
<p>Wrap queries in <code>withCte()</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_other_variations"><a class="anchor" href="#_other_variations"></a>Other variations</h3>
<div class="ulist">
<ul>
<li>
<p><code>selectExists()</code>: a convenience function for querying the existence of a result in a query</p>
</li>
<li>
<p><code>subSelect()</code>: builds a sub-query node</p>
</li>
<li>
<p><code>selectSubQuery()</code>: builds an aliased sub-query</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_transactions"><a class="anchor" href="#_transactions"></a>Transactions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_begin"><a class="anchor" href="#_begin"></a><code>begin()</code></h3>
<div class="paragraph">
<p>Starts a transaction. You can set the transaction&#8217;s isolation level, read mode, and deferrable flag.</p>
</div>
<div class="sect3">
<h4 id="_chained_methods_2"><a class="anchor" href="#_chained_methods_2"></a>Chained methods</h4>
<div class="ulist">
<ul>
<li>
<p><code>isolationLevel()</code>: sets the isolation level</p>
</li>
<li>
<p><code>readMode()</code>: sets the read mode</p>
</li>
<li>
<p><code>deferrable()</code>: sets the deferrable flag</p>
</li>
<li>
<p><code>finalise()</code>: prepares the query so that it can be executed</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_commit"><a class="anchor" href="#_commit"></a><code>commit()</code></h3>
<div class="paragraph">
<p>Ends a transaction, committing it.</p>
</div>
<div class="sect3">
<h4 id="_chained_methods_3"><a class="anchor" href="#_chained_methods_3"></a>Chained methods</h4>
<div class="ulist">
<ul>
<li>
<p><code>andChain()</code>: sets whether a new transaction is immediately started with the same characteristics.</p>
</li>
<li>
<p><code>finalise()</code>: prepares the query so that it can be executed</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rollback"><a class="anchor" href="#_rollback"></a><code>rollback()</code></h3>
<div class="paragraph">
<p>Aborts a transction.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>andChain()</code>: sets whether a new transaction is immediately started with the same characteristics.</p>
</li>
<li>
<p><code>finalise()</code>: prepares the query so that it can be executed</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the rose Antora UI theme.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
